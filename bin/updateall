#!/usr/bin/env ruby
# -*- coding:utf-8 -*-

require 'pathname'

class Pathname
  @@vcs_update_command_table = {
    '.git' => 'git pull',
    '.hg' => 'hg pull -u',
    '.svn' => 'svn up',
    '.bzr' => 'bzr up',
  }

  def repo?(metadata)
    self.directory? && self.children.any? {|d| File.basename(d) == metadata }
  end

  def update()
    Dir::chdir(self) do
      p = Pathname::pwd()
      @@vcs_update_command_table.each do |metadata, command|
        next unless p.repo?(metadata)
        puts "UPDATE \"#{p}\""
        system(command)
      end
    end
  end
end

dir = ARGV.shift || '.'
Pathname.new(dir).each_child do |p|
  next unless p.directory?
  p.update
end
