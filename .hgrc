# -*- coding:utf-8; mode:conf; -*-
# hgrc

[ui]
username = Takumi IINO <trot.thunder@gmail.com>
ignore = $HOME/.mercurial/hgignore

[extensions]
churn =
color =
convert =
eol =
extdiff =
graphlog =
histedit =
mq =
pager =
parentrevspec =
progress =
rebase =
record =
schemes =
transplant =

[diff]
git = True
showfunc = True
unified = 5

[email]
method = smtp
from = Takumi IINO <trot.thunder@gmail.com>

[smtp]
host = smtp.gmail.com
port = 587
username = trot.thunder@gmail.com
tls = True

[color]
changeset.secret = blue bold underline
changeset.draft = green underline
changeset.public = yellow
gshortlog.branch.default = white
gshortlog.branch.other = cyan bold
gshortlog.bookmarks = red bold
gshortlog.tags = green bold

[pager]
pager = LESS='MFRX' less
attend =
  annotate, cat, export,
  diff, qdiff, fdiff, qfdiff,
  glog, log, help, shortlog, gshortlog,
  show, less, pulled, wip,
  grepfile, gf,

[mq]
secret = True

[revsetalias]
wip = (ancestors(.) and (not public()))
pulled = (tip:. - .)

[alias]
# save original command.
_status = status
_push = push

# just push the current changest ancestors.
nudge = _push --rev .
push = ! \
  echo -e "\033[33mNOTICE: please use 'hg nudge' to push changesets.\033[m" && \
  $HG _push --rev .

# useful short cuts.
. = st
b = branch

# branch.
bs = branches -a

# braphlog.
gl = glog
gll = glog --limit

# relative path status.
st = ! $HG _status $($HG root) $HG_ARGS

# diff.
fdiff = diff -U 10000000000000
qfdiff = qdiff -U 10000000000000

# commit
cm = commit --message
cmm = ! $HG commit -m "merge with $(hg log -r 'p2()' --template '{branch}')"

# browse changesets.
show = log --color=always -vpr
less = log -vpr "reverse(not merge())"
pulled = log -vpr "pulled and (not merge())"
wip = log -vpr "wip"

# grep files.
#grepfile = ! $HG locate --print0 | xargs --null grep $@
gf = grepfile

# merge conflict resolve utilities.
mark = resolve -m
unmark = resolve -u
conflicts = resolve -l
uselocal = resolve --tool internal:local
useother = resolve --tool internal:other

# mq.
qi = qimport
qr = qrefresh
qf = qfinish
qls = qseries --summary
qst = _status --change qtip

# drag to qtip and apply.
qdrag = qpush --move

# empty the current mq patch.
qempty = ! $HG qrefresh -X $($HG root)

# import all wip changesets to mq patch
qimportwip = qimport -r 'wip and (not mq())'
qiwip = qimportwip

# create partial commit/mq patch
now = ! \
  $HG commit -m "[from now] $(date +'%Y-%m-%d %H:%M:%S')" \
  $@
qnow = ! \
  $HG qnew -m "[from qnow] $(date +'%Y-%m-%d %H:%M:%S')" \
  $(date +'%Y-%m-%d_%H-%M-%S.diff') $@

# power of commit
poc = churn -t '{author|email}' -c

# phortlog alias.
shortlog  = log  --template "{label('changeset.{phase}', '{rev}:{node|short}')}{ifeq(p2node|short, '000000000000', '', '\033[1m\033[30m')} | {date|shortdate} | {author|emailuser}: {desc|strip|firstline}\033[0m\n"
gshortlog = glog --template "{label('changeset.{phase}', '{rev}:{node|short}')}{ifeq(p2node|short, '000000000000', '', '\033[1m\033[30m')} | {date|shortdate} | {author|emailuser}: {desc|strip|firstline}\033[0m
  {ifeq(branch, 'default', label('gshortlog.branch.default', 'default'), label('gshortlog.branch.other', '{branch}'))
  }{if(bookmarks, '[')}{label('gshortlog.bookmarks', join(bookmarks, ','))}{if(bookmarks, ']')}{if(tags, '[')}{if(tags, label('gshortlog.tags', join(tags, ',')))}{if(tags, ']')}
  "

[hostfingerprints]
bitbucket.org = 67:b3:bf:9f:c5:38:0e:4c:dd:4e:8a:da:3d:11:1b:c2:a5:d1:6c:6b
smtp.gmail.com = 10:75:e1:8c:df:93:15:3b:a1:8f:cd:fe:d3:11:79:d5:16:43:77:bc

# include settings
%include $HOME/.mercurial/typo.rc
%include $HOME/.mercurial/extensions.rc
%include $HOME/.mercurial/hooks.rc
%include $HOME/.mercurial/araxis.rc
%include $HOME/.mercurial/local.rc
%include $HOME/.hgrc_local
